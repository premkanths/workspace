<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workspace Hub ¬∑ Calendar Book</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body class="calendar-page">
    <header class="site-header">
        <div class="logo">WorkspaceHub<span>PK</span></div>
        <nav>
            <a href="index.html">Home</a>
            <a href="todo.html">To-Do</a>
            <a href="organizer.html">BoxPad</a>
            <a href="calendar.html" class="active-link">Calendar</a>
            <a href="notepad.html">Notepad</a>
        </nav>
        <button class="theme-toggle" aria-label="Toggle color mode">
            <span class="theme-toggle__sun">‚òÄÔ∏è</span>
            <span class="theme-toggle__moon">üåô</span>
        </button>
    </header>

    <main class="page-content">
        <section class="panel highlight">
            <div>
                <p class="panel-label">üìÖ Calendar Book</p>
                <h1>Daily notes organized by date.</h1>
                <p class="panel-subtitle">Select a date and write your daily notes.</p>
            </div>
        </section>

        <section class="panel">
            <div class="calendar-layout">
                <div class="calendar-container">
                    <div class="calendar-header">
                        <button id="prevMonth" class="calendar-nav">‚Äπ</button>
                        <h2 id="calendarMonthYear"></h2>
                        <button id="nextMonth" class="calendar-nav">‚Ä∫</button>
                    </div>
                    <div id="calendarGrid" class="calendar-grid"></div>
                </div>
                
                <div class="notes-container">
                    <div class="notes-header">
                        <h3 id="selectedDateText">Select a date to start writing</h3>
                    </div>
                    <textarea 
                        id="dailyNote" 
                        class="daily-note"
                        placeholder="Write your notes for this day..."
                    ></textarea>
                    <div class="notes-actions">
                        <button id="saveNote" class="primary">Save Note</button>
                        <button id="clearNote" class="ghost">Clear</button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="site-footer compact">
        <small>Your daily thoughts, organized day by day.</small>
    </footer>

    <script src="script.js" defer></script>
    <script>
        // Calendar Book functionality
        function initCalendarBook() {
            const calendarGrid = document.getElementById('calendarGrid');
            const calendarMonthYear = document.getElementById('calendarMonthYear');
            const prevMonthBtn = document.getElementById('prevMonth');
            const nextMonthBtn = document.getElementById('nextMonth');
            const dailyNote = document.getElementById('dailyNote');
            const saveNoteBtn = document.getElementById('saveNote');
            const clearNoteBtn = document.getElementById('clearNote');
            const selectedDateText = document.getElementById('selectedDateText');

            if (!calendarGrid) return;

            let currentDate = new Date();
            let selectedDate = new Date();
            const STORAGE_KEY = 'workspaceHubCalendarNotes';
            
            // Ensure we're using the same storage key pattern

            // Load notes from localStorage
            function loadNotes() {
                const notes = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
                return notes;
            }

            // Save notes to localStorage
            function saveNotes(notes) {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(notes));
            }

            // Format date as YYYY-MM-DD
            function formatDateKey(date) {
                return date.toISOString().split('T')[0];
            }

            // Get current month and year
            function getCurrentMonthYear() {
                return currentDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            }

            // Render calendar
            function renderCalendar() {
                calendarMonthYear.textContent = getCurrentMonthYear();
                calendarGrid.innerHTML = '';

                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();

                // Get first day of month and number of days
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const daysInMonth = lastDay.getDate();
                const startingDayOfWeek = firstDay.getDay();

                // Day names
                const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                dayNames.forEach(day => {
                    const dayHeader = document.createElement('div');
                    dayHeader.className = 'calendar-day-header';
                    dayHeader.textContent = day;
                    calendarGrid.appendChild(dayHeader);
                });

                // Empty cells for days before month starts
                for (let i = 0; i < startingDayOfWeek; i++) {
                    const emptyCell = document.createElement('div');
                    emptyCell.className = 'calendar-day empty';
                    calendarGrid.appendChild(emptyCell);
                }

                // Days of the month
                const notes = loadNotes();
                const today = new Date();
                today.setHours(0, 0, 0, 0);

                for (let day = 1; day <= daysInMonth; day++) {
                    const dayCell = document.createElement('div');
                    const cellDate = new Date(year, month, day);
                    const dateKey = formatDateKey(cellDate);
                    const isToday = cellDate.getTime() === today.getTime();
                    const isSelected = formatDateKey(selectedDate) === dateKey;
                    const hasNote = notes[dateKey] && notes[dateKey].trim().length > 0;

                    dayCell.className = 'calendar-day';
                    if (isToday) dayCell.classList.add('today');
                    if (isSelected) dayCell.classList.add('selected');
                    if (hasNote) dayCell.classList.add('has-note');

                    dayCell.textContent = day;
                    dayCell.addEventListener('click', () => {
                        selectedDate = new Date(year, month, day);
                        loadNoteForDate(selectedDate);
                        renderCalendar();
                    });

                    calendarGrid.appendChild(dayCell);
                }
            }

            // Load note for selected date
            function loadNoteForDate(date) {
                const dateKey = formatDateKey(date);
                const notes = loadNotes();
                dailyNote.value = notes[dateKey] || '';
                
                const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                selectedDateText.textContent = date.toLocaleDateString('en-US', dateOptions);
            }

            // Save note
            function saveNote() {
                const dateKey = formatDateKey(selectedDate);
                const notes = loadNotes();
                notes[dateKey] = dailyNote.value;
                saveNotes(notes);
                renderCalendar();
                
                // Show feedback
                const originalText = saveNoteBtn.textContent;
                saveNoteBtn.textContent = 'Saved!';
                setTimeout(() => {
                    saveNoteBtn.textContent = originalText;
                }, 2000);
            }

            // Clear note
            function clearNote() {
                if (!confirm('Clear this note? This action cannot be undone.')) return;
                dailyNote.value = '';
                const dateKey = formatDateKey(selectedDate);
                const notes = loadNotes();
                delete notes[dateKey];
                saveNotes(notes);
                renderCalendar();
            }

            // Navigation
            prevMonthBtn.addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() - 1);
                renderCalendar();
            });

            nextMonthBtn.addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar();
            });

            // Event listeners
            saveNoteBtn.addEventListener('click', saveNote);
            clearNoteBtn.addEventListener('click', clearNote);
            
            // Auto-save on input (debounced)
            let saveTimeout;
            dailyNote.addEventListener('input', () => {
                clearTimeout(saveTimeout);
                saveTimeout = setTimeout(() => {
                    const dateKey = formatDateKey(selectedDate);
                    const notes = loadNotes();
                    notes[dateKey] = dailyNote.value;
                    saveNotes(notes);
                    renderCalendar();
                }, 1000);
            });

            // Initialize
            renderCalendar();
            loadNoteForDate(selectedDate);
        }

        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initCalendarBook);
        } else {
            initCalendarBook();
        }
    </script>
</body>
</html>

